{% extends "base.html" %}

{% block contenido %}

<div class="container">
    <div class="card">
        <div class="card-body">
            <h2 class="card-title text-center">Perfil de Usuario</h2>
            <p><strong>Usuario:</strong> {{ user.username }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Nombre:</strong> {{ user.first_name }}</p>
            <p><strong>Apellido:</strong> {{ user.last_name }}</p>
            <p><strong>Profesion:</strong> {{ user.profesion }}</p>
            <p><strong>dni:</strong> {{ user.dni }}</p>

            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#perfilModal">
                Editar Perfil
            </button>
        </div>
    </div>
</div>

<!-- Modal de edición de perfil -->
<!-- Modal de edición de perfil -->
<div class="modal fade" id="perfilModal" tabindex="-1" aria-labelledby="perfilModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="perfilModalLabel">Editar Perfil de Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="perfilForm" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_username">Usuario:</label>
                        <input type="text" id="id_username" name="username" class="form-control" value="{{ user.username }}" required>
                    </div>
                    <div class="form-group">
                        <label for="id_email">Email:</label>
                        <input type="email" id="id_email" name="email" class="form-control" value="{{ user.email }}" required>
                    </div>
                    <div class="form-group">
                        <label for="id_first_name">Nombre:</label>
                        <input type="text" id="id_first_name" name="first_name" class="form-control" value="{{ user.first_name }}" required>
                    </div>
                    <div class="form-group">
                        <label for="id_last_name">Apellido:</label>
                        <input type="text" id="id_last_name" name="last_name" class="form-control" value="{{ user.last_name }}" required>
                    </div>
                    <div class="form-group">
                        <label for="id_profesion">Profesion:</label>
                        <input type="text" id="id_profesion" name="profesion" class="form-control" value="{{ user.profesion }}" required>
                    </div>
                    <div class="form-group">
                        <label for="id_dni">DNI:</label>
                        <input type="text" id="id_dni" name="dni" class="form-control" value="{{ user.dni }}" required>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    document.getElementById("perfilForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Evitar que el formulario se envíe de forma tradicional
        const form = event.target;
        const formData = new FormData(form);
        fetch(form.action, {
            method: form.method,
            body: formData,
            headers: {
                "X-CSRFToken": form.elements.csrfmiddlewaretoken.value, 
            },
        })
            .then(response => response.json())
            .then(data => {
                // Aquí puedes manejar la respuesta del servidor después de guardar los cambios
                console.log(data);
                // Cerrar el modal después de guardar los cambios
                const perfilModal = new bootstrap.Modal(document.getElementById('perfilModal'));
                perfilModal.hide();
            })
            .catch(error => {
                // Aquí puedes manejar errores si es necesario
                console.error(error);
            });
    });
</script>

{% endblock %}

